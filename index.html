<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Brevis Blockdrop</title>
<link rel="icon" href="logo.png" />
<style>
  :root{
    --page-bg: #242323;
    --accent-cyan: #00ffff;
    --accent-magenta: #ff00ff;
    --soft-panel: rgba(30,30,30,0.9);
    --card-bg: rgba(40,40,40,0.82);
    --text-light: #eaeaea;
    --muted: #9a9a9a;
  }

  html,body{
    height:100%;
    margin:0;
    background: linear-gradient(180deg,#262525 0%,var(--page-bg) 100%);
    color:var(--text-light);
    font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;
  }

  .top-left-logo{
    position:fixed;
    left:24px;
    top:18px;
    display:flex;
    align-items:center;
    gap:12px;
    z-index:30;
  }
  .top-left-logo img{
    height:64px;
    width:auto;
    display:block;
    border-radius:0;
    box-shadow:none;
  }
  .top-left-logo h1{
    margin:0;
    font-size:24px;
    color:var(--accent-cyan);
    text-shadow:0 0 10px rgba(0,255,255,0.4),0 0 20px rgba(255,0,255,0.2);
  }

  .page{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px 80px;
    box-sizing:border-box;
    gap:40px;
  }

  .left-art, .right-art {
    width:240px;
    height:480px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .left-art img, .right-art img {
    width:100%;
    height:auto;
    border-radius:12px;
    object-fit:contain;
    filter: drop-shadow(0 0 15px var(--accent-cyan));
  }

  .stage{display:flex;align-items:center;justify-content:center;position:relative;gap:12px;}

  canvas#game{
    background:#1b1b1b;
    border-radius:8px;
    width:360px;
    height:720px;
    image-rendering:pixelated;
    box-shadow:0 10px 30px rgba(0,255,255,0.04),0 18px 40px rgba(255,0,255,0.03);
    border:4px solid transparent;
    border-image-source:linear-gradient(90deg,rgba(0,255,255,0.18),rgba(255,0,255,0.18),rgba(0,255,255,0.18));
    border-image-slice:1;
  }

  .overlay{position:absolute;inset:0;background:rgba(10,10,10,0.85);display:none;flex-direction:column;align-items:center;justify-content:center;gap:10px;text-align:center;color:var(--text-light);}
  .overlay.show{display:flex;}

  .btn{padding:6px 12px;border:none;border-radius:6px;background:var(--accent-cyan);cursor:pointer;color:#081010;font-weight:700;box-shadow:0 6px 18px rgba(0,255,255,0.12);}
  .btn:hover{background:var(--accent-magenta);box-shadow:0 10px 28px rgba(255,0,255,0.12);}

  .sidebar{width:260px;display:flex;flex-direction:column;gap:16px;}
  .card{background:var(--card-bg);border-radius:10px;padding:12px;box-shadow:0 6px 20px rgba(0,0,0,0.5);color:var(--text-light);border:1px solid rgba(255,255,255,0.02);}
  .controls h2{margin:0 0 8px 0;font-size:14px;color:var(--accent-cyan);}
  .controls p{margin:0;font-size:13px;line-height:1.6;color:var(--muted);}
  .controls .kbd{display:inline-block;background:#2b2b2b;padding:4px 8px;border-radius:6px;margin-right:6px;font-size:12px;color:var(--text-light);}
  .score{font-weight:700;font-size:18px;text-align:center;padding:8px 0;color:var(--accent-cyan);}
  footer{position:fixed;right:18px;bottom:18px;font-size:12px;color:var(--accent-magenta);text-shadow:0 0 8px rgba(255,0,255,0.06);}
  .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}
  .access-panel{position:fixed;left:18px;bottom:18px;background:rgba(20,20,20,0.92);padding:10px;border-radius:10px;box-shadow:0 8px 26px rgba(0,0,0,0.5);z-index:30;color:var(--text-light)}
  .access-panel label{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted)}

  @media(max-width:980px){
    .page{padding:20px;flex-direction:column;}
    canvas#game{width:280px;height:560px;}
    .sidebar{width:100%;max-width:360px;}
    .left-art,.right-art{display:none;}
  }
</style>
</head>
<body>

  <div class="top-left-logo">
    <img src="logo.png" alt="Brevis Logo" />
    <h1>Brevis Blockdrop</h1>
  </div>

  <div class="page">
    <div class="left-art"><img src="left.png" alt="Left Image" /></div>

    <div class="stage">
      <canvas id="game" width="10" height="20"></canvas>
      <div class="overlay" id="gameOverOverlay">
        <div style="font-size:22px;font-weight:800">GAME OVER</div>
        <div id="finalScoreText" style="font-size:16px"></div>
        <div style="display:flex;gap:10px">
          <button class="btn" id="restartBtn">Restart</button>
        </div>
      </div>
    </div>

    <aside class="sidebar">
      <div class="card score" id="scoreBox">Score: 0</div>
      <div class="card controls">
        <h2>Controls</h2>
        <p>
          <span class="kbd">P</span> Pause<br>
          <span class="kbd">←</span> Left<br>
          <span class="kbd">→</span> Right<br>
          <span class="kbd">↓</span> Soft Drop<br>
          <span class="kbd">↑</span> Rotate<br>
          <span class="kbd">Space</span> Hard Drop<br>
          <span class="kbd">Q</span> Rotate Left<br>
        </p>
      </div>
      <div class="card" style="text-align:center">
        <div style="font-size:13px;font-weight:700">Audio Accessibility</div>
        <div style="font-size:12px;margin-top:6px">Each block type has a unique sound cue. Move, rotate, and drop trigger sound feedback.</div>
      </div>
      <div class="right-art"><img src="right.png" alt="Right Image" /></div>
    </aside>
  </div>

  <footer>Brevis Blockdrop</footer>

  <div class="access-panel" id="accessPanel">
    <div style="font-weight:700;margin-bottom:6px">Accessibility</div>
    <label><input type="checkbox" id="audioModeToggle"> Audio Mode (B)</label>
    <label><input type="checkbox" id="voiceGuideToggle" checked> Voice Guide</label>
    <label><input type="checkbox" id="vibrateToggle"> Haptic (vibrate)</label>
    <div style="font-size:12px;margin-top:8px">Shortcuts: <strong>M</strong> menu, <strong>B</strong> audio, <strong>H</strong> help</div>
  </div>

  <div aria-live="polite" id="srLive" class="visually-hidden"></div>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const COLS=10,ROWS=20;
ctx.scale(36,36);
canvas.width=COLS;canvas.height=ROWS;
const colors=[null,'#00FFFF','#FF00FF','#FF8A00','#00FF9D','#FFD700','#FF1493'];
const pieces='ILJOTSZ'.split('');
let board=createMatrix(COLS,ROWS);
let isPaused=false,dropCounter=0,dropInterval=800,lastTime=0,score=0;
const scoreBox=document.getElementById('scoreBox'),overlay=document.getElementById('gameOverOverlay'),finalScoreText=document.getElementById('finalScoreText');
const audioToggle=document.getElementById('audioModeToggle'),voiceToggle=document.getElementById('voiceGuideToggle'),vibrateToggle=document.getElementById('vibrateToggle'),srLive=document.getElementById('srLive');
const settings=JSON.parse(localStorage.getItem('echo_settings')||'{}');
audioToggle.checked=!!settings.audioMode;voiceToggle.checked=settings.voiceGuide!==false;vibrateToggle.checked=!!settings.vibrate;
let audioCtx=null;
function initAudio(){if(audioCtx)return audioCtx;try{audioCtx=new(window.AudioContext||window.webkitAudioContext)();}catch(e){audioCtx=null;}return audioCtx;}
function playTone(f=440,d=120,p=0,t='sine',g=0.08){if(!audioToggle.checked)return;const a=initAudio();if(!a)return;const o=a.createOscillator(),ga=a.createGain(),pa=a.createStereoPanner();o.type=t;o.frequency.value=f;ga.gain.value=g;pa.pan.value=Math.max(-1,Math.min(1,p));o.connect(ga).connect(pa).connect(a.destination);o.start();o.stop(a.currentTime+d/1000);}
function speak(t){if(!voiceToggle.checked)return;if('speechSynthesis'in window){const u=new SpeechSynthesisUtterance(t);u.rate=1.0;speechSynthesis.cancel();speechSynthesis.speak(u);}else srLive.textContent=t;}
function vib(m=80){if(!vibrateToggle.checked)return;if(navigator.vibrate)navigator.vibrate(m);}
function announce(m){srLive.textContent=m;speak(m);}
function saveSettings(){localStorage.setItem('echo_settings',JSON.stringify({audioMode:audioToggle.checked,voiceGuide:voiceToggle.checked,vibrate:vibrateToggle.checked}));}
audioToggle.addEventListener('change',()=>{saveSettings();announce('Audio mode '+(audioToggle.checked?'on':'off'));initAudio();});
voiceToggle.addEventListener('change',()=>{saveSettings();announce('Voice guide '+(voiceToggle.checked?'on':'off'));});
vibrateToggle.addEventListener('change',()=>{saveSettings();announce('Haptic '+(vibrateToggle.checked?'on':'off'));});
function playSound(){const f=[440,554,659,784,880,988,1047][Math.ceil(Math.random()*7)-1];playTone(f,120,0,'sine',0.08);}
function createMatrix(w,h){const m=[];while(h--)m.push(new Array(w).fill(0));return m;}
function collide(b,p){const[m,o]=[p.matrix,p.pos];for(let y=0;y<m.length;y++)for(let x=0;x<m[y].length;x++)if(m[y][x]!==0&&(b[y+o.y]&&b[y+o.y][x+o.x])!==0)return true;return false;}
function merge(b,p){p.matrix.forEach((r,y)=>r.forEach((v,x)=>{if(v!==0)b[y+p.pos.y][x+p.pos.x]=v;}));}
function rotate(m,d){for(let y=0;y<m.length;y++)for(let x=0;x<y;x++) [m[x][y],m[y][x]]=[m[y][x],m[x][y]];if(d>0)m.forEach(r=>r.reverse());else m.reverse();}
function createPiece(t){switch(t){case'T':return[[0,1,0],[1,1,1],[0,0,0]];case'O':return[[1,1],[1,1]];case'L':return[[0,2,0],[0,2,0],[0,2,2]];case'J':return[[0,3,0],[0,3,0],[3,3,0]];case'I':return[[0,4,0,0],[0,4,0,0],[0,4,0,0],[0,4,0,0]];case'S':return[[0,5,5],[5,5,0],[0,0,0]];case'Z':return[[6,6,0],[0,6,6],[0,0,0]];}}
const player={pos:{x:0,y:0},matrix:null};
function playerReset(){const t=pieces[Math.floor(Math.random()*pieces.length)];player.matrix=createPiece(t);player.pos.y=0;player.pos.x=(COLS/2|0)-(player.matrix[0].length/2|0);if(collide(board,player)){board.forEach(r=>r.fill(0));showGameOver();}else{if(audioToggle.checked){const pan=(player.pos.x/(COLS-1))*2-1;playTone(200+Math.random()*400,120,pan,'triangle');}if(voiceToggle.checked)speak('New piece: '+t);}}
function playerDrop(){player.pos.y++;if(collide(board,player)){player.pos.y--;merge(board,player);playSound();vib(30);playerReset();sweep();}dropCounter=0;}
function playerMove(d){player.pos.x+=d;if(collide(board,player))player.pos.x-=d;else{const pan=(player.pos.x/(COLS-1))*2-1;playTone(300+Math.abs(d)*50,60,pan,'square',0.06);if(voiceToggle.checked)speak(d>0?'Right':'Left');}}
function playerRotate(d){const p=player.pos.x;let o=1;rotate(player.matrix,d);while(collide(board,player)){player.pos.x+=o;o=-(o+(o>0?1:-1));if(o>player.matrix[0].length){rotate(player.matrix,-d);player.pos.x=p;return;}}playSound();if(voiceToggle.checked)speak('Rotate');}
function sweep(){outer:for(let y=board.length-1;y>0;y--){for(let x=0;x<board[y].length;x++){if(board[y][x]===0)continue outer;}const r=board.splice(y,1)[0].fill(0);board.unshift(r);y++;score+=100;scoreBox.textContent="Score: "+score;playTone(880,300,0,'sawtooth',0.12);speak('Line cleared. Score '+score);vib(120);}}
function drawMatrix(m,o){m.forEach((r,y)=>r.forEach((v,x)=>{if(v!==0){ctx.fillStyle=colors[v]||'#00FFFF';ctx.fillRect(x+o.x,y+o.y,1,1);}}));}
function draw(){ctx.fillStyle='#1b1b1b';ctx.fillRect(0,0,COLS,ROWS);drawMatrix(board,{x:0,y:0});drawMatrix(player.matrix,player.pos);}
function update(t=0){if(isPaused)return;const d=t-lastTime;lastTime=t;dropCounter+=d;if(dropCounter>dropInterval)playerDrop();draw();requestAnimationFrame(update);}
let accessPanelVisible=true;
document.addEventListener('keydown',e=>{if(e.key==='ArrowLeft')playerMove(-1);else if(e.key==='ArrowRight')playerMove(1);else if(e.key==='p'||e.key==='P'){isPaused=!isPaused;if(isPaused)announce('Game paused');else{announce('Game resumed');requestAnimationFrame(update);}}else if(e.key==='ArrowDown')playerDrop();else if(e.key==='ArrowUp')playerRotate(1);else if(e.key==='q'||e.key==='Q')playerRotate(-1);else if(e.key===' '){while(!collide(board,player))player.pos.y++;player.pos.y--;playerDrop();}else if(e.key==='b'||e.key==='B'){audioToggle.checked=!audioToggle.checked;audioToggle.dispatchEvent(new Event('change'));}else if(e.key==='m'||e.key==='M'){accessPanelVisible=!accessPanelVisible;document.getElementById('accessPanel').style.display=accessPanelVisible?'block':'none';announce(accessPanelVisible?'Accessibility menu shown':'Accessibility menu hidden');}else if(e.key==='h'||e.key==='H')provideHelp();});
function showGameOver(){finalScoreText.textContent="Final Score: "+score;overlay.classList.add('show');announce('Game over. Final score '+score);}
document.getElementById('restartBtn').addEventListener('click',()=>{overlay.classList.remove('show');score=0;scoreBox.textContent="Score: 0";board=createMatrix(COLS,ROWS);playerReset();});
function provideHelp(){announce('Controls: arrow left right down up. Space to hard drop. Q rotates left. P for Pause. Press B for audio. M menu. H help.');}
announce('Welcome to Brevis Blockdrop. Press H for help. Press B to toggle audio mode.');
playerReset();update();window.addEventListener('beforeunload',saveSettings);
</script>
</body>
</html>
